<!DOCTYPE html>
<html lang="fr">
<head>
  <!-- BASE -->
  <meta charset="UTF-8">
  <title>PharmaConnect – Pharmacies proches</title>

  <!-- RESPONSIVE / MOBILE -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">

  <!-- DESCRIPTION (SEO léger + partage) -->
  <meta name="description" content="PharmaConnect vous aide à trouver rapidement les pharmacies proches de vous grâce à la géolocalisation. Simple, rapide et gratuit.">

  <!-- THEME / COULEUR APP - Solution optimisée avec manifest.json -->
  <!-- theme-color pour Chrome/Edge/Safari (optionnel, génère un warning sur Firefox) -->
  <!-- <meta name="theme-color" content="#667eea"> -->
  
  <!-- Alternative sans warning : on utilise uniquement le manifest.json -->
  <!-- Fallback pour les navigateurs sans support PWA -->
  <meta name="background-color" content="#ffffff">
  
  <!-- Pour Safari iOS et macOS -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="PharmaConnect">
  
  <!-- Pour Windows/Edge (ancien) -->
  <meta name="msapplication-navbutton-color" content="#667eea">
  <meta name="msapplication-TileColor" content="#667eea">
  <meta name="msapplication-TileImage" content="icon-192.png">

  <!-- PWA MANIFEST (source principale pour theme-color cross-browser) -->
  <link rel="manifest" href="manifest.json">

  <!-- ICONES PWA - Version simplifiée et correcte -->
  <!-- Une seule ligne par taille, pas de doublons -->
  <link rel="apple-touch-icon" sizes="192x192" href="icon-192.png">
  <link rel="apple-touch-icon" sizes="512x512" href="icon-512.png">
  
  <!-- FAVICON -->
  <link rel="icon" type="image/png" sizes="32x32" href="icon-192.png">
  <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">

  <!-- POLICE SYSTÈME ET STYLES DE BASE -->
  <style>
    :root {
      color-scheme: light;
      --primary-color: #667eea;
      --theme-color: #667eea;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI",
                   Roboto, Oxygen, Ubuntu, Cantarell,
                   "Helvetica Neue", Arial, sans-serif;
      /* Fallback background pour les navigateurs sans PWA support */
      background-color: #f5f7fa;
    }
    
    /* Support pour thème sombre */
    @media (prefers-color-scheme: dark) {
      :root {
        color-scheme: dark;
        --primary-color: #764ba2;
      }
      body {
        background-color: #1a202c;
      }
    }
    
    /* Support pour les navigateurs qui n'ont pas de color-scheme */
    @supports not (color-scheme: light) {
      body {
        color: #2d3748;
        background-color: #f5f7fa;
      }
    }
  </style>

  <!-- CSS APP -->
  <link rel="stylesheet" href="pharma.css">
</head>

<body>
  <div class="bg-animation">
    <div class="floating-shape shape-1"></div>
    <div class="floating-shape shape-2"></div>
    <div class="floating-shape shape-3"></div>
  </div>

  <div class="app">
    <!-- ÉCRAN D'ACCUEIL -->
    <div class="welcome-screen" id="welcome-screen">
      <div class="logo-container">
        <div class="logo-circle">
          <svg class="logo-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M10.5 2.5H13.5L14 5H10L10.5 2.5Z" fill="currentColor"/>
            <path d="M19 8H5C3.89543 8 3 8.89543 3 10V19C3 20.1046 3.89543 21 5 21H19C20.1046 21 21 20.1046 21 19V10C21 8.89543 20.1046 8 19 8Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M12 13V17M10 15H14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </div>
      </div>
      <h2 class="greeting" id="greeting">Bonjour</h2>
      <h1 class="app-name">PharmaConnect</h1>
      <div class="typing-message" id="typing-message"></div>
      <div class="choice-buttons" id="choice-buttons">
        <button class="choice-btn btn-yes" id="btn-yes">
          <svg class="btn-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M20 6L9 17L4 12" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span>Oui, localiser</span>
        </button>
        <button class="choice-btn btn-no" id="btn-no">
          <svg class="btn-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span>Non merci</span>
        </button>
      </div>
    </div>

    <!-- ÉCRAN DE RECHERCHE -->
    <div class="search-screen" id="search-screen">
      <div class="header">
        <button class="exit-btn" id="exit-btn" title="Quitter">
          <svg class="exit-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
        <h1>Recherche en cours</h1>
        <p>Analyse de votre zone</p>
      </div>

      <div class="status" id="status">
        <div class="status-icon-container">
          <svg class="status-icon" id="status-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 2C8.13 2 5 5.13 5 9C5 14.25 12 22 12 22C12 22 19 14.25 19 9C19 5.13 15.87 2 12 2ZM12 11.5C10.62 11.5 9.5 10.38 9.5 9C9.5 7.62 10.62 6.5 12 6.5C13.38 6.5 14.5 7.62 14.5 9C14.5 10.38 13.38 11.5 12 11.5Z" fill="#667eea"/>
          </svg>
        </div>
        <div class="message" id="status-message">Initialisation...</div>
        <div class="loading-spinner" id="loading"></div>
      </div>

      <div class="pharmacy-list" id="pharmacy-list"></div>

      <div class="footer">
        <p>Données en temps réel via OpenStreetMap</p>
        <button class="retry-button" id="retry-button">
          <svg class="retry-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M1 4V10H7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M23 20V14H17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M20.49 9C19.9828 7.56678 19.1209 6.28536 17.9845 5.27542C16.8482 4.26548 15.4745 3.55976 13.9917 3.22426C12.5089 2.88875 10.9652 2.93434 9.50481 3.35677C8.04437 3.77921 6.71475 4.56471 5.64 5.64L1 10M23 14L18.36 18.36C17.2853 19.4353 15.9556 20.2208 14.4952 20.6432C13.0348 21.0657 11.4911 21.1113 10.0083 20.7757C8.52547 20.4402 7.1518 19.7345 6.01547 18.7246C4.87913 17.7146 4.01717 16.4332 3.51 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Nouvelle recherche
        </button>
      </div>
    </div>

    <!-- ÉCRAN DE REFUS -->
    <div class="goodbye-screen" id="goodbye-screen">
      <div class="goodbye-icon-container">
        <svg class="goodbye-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="12" cy="12" r="10" stroke="#667eea" stroke-width="2"/>
          <path d="M8 14C8 14 9.5 16 12 16C14.5 16 16 14 16 14" stroke="#667eea" stroke-width="2" stroke-linecap="round"/>
          <circle cx="9" cy="9" r="1" fill="#667eea"/>
          <circle cx="15" cy="9" r="1" fill="#667eea"/>
        </svg>
      </div>
      <h2 class="goodbye-message">Pas de problème !</h2>
      <p class="goodbye-text">
        Nous restons à votre disposition pour vous aider à trouver une pharmacie proche de vous quand vous en aurez besoin.
      </p>
      <button class="back-btn" id="back-btn">
        <svg class="back-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M19 12H5M12 19L5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Retour à l'accueil
      </button>
    </div>
  </div>

  <script src="pharma.js"></script>
  <script>
    // Service Worker pour PWA
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js')
          .then(() => console.log("SW enregistré"))
          .catch(err => console.log("SW erreur", err));
      });
    }

    // Gestion des événements après le chargement du DOM
    document.addEventListener('DOMContentLoaded', function() {
      // Récupération des éléments
      const btnYes = document.getElementById('btn-yes');
      const btnNo = document.getElementById('btn-no');
      const exitBtn = document.getElementById('exit-btn');
      const retryBtn = document.getElementById('retry-button');
      const backBtn = document.getElementById('back-btn');
      
      // Ajout des événements
      if (btnYes) {
        btnYes.addEventListener('click', function() {
          if (typeof startSearch === 'function') startSearch();
        });
      }
      
      if (btnNo) {
        btnNo.addEventListener('click', function() {
          if (typeof declineSearch === 'function') declineSearch();
        });
      }
      
      if (exitBtn) {
        exitBtn.addEventListener('click', function() {
          if (typeof exitSearch === 'function') exitSearch();
        });
      }
      
      if (retryBtn) {
        retryBtn.addEventListener('click', function() {
          if (typeof retrySearch === 'function') retrySearch();
        });
      }
      
      if (backBtn) {
        backBtn.addEventListener('click', function() {
          if (typeof backToHome === 'function') backToHome();
        });
      }
      
      // Masquer le bouton retry au démarrage (géré via CSS)
      // L'animation d'apparition des boutons est gérée par le CSS
    });
  </script>
</body>
</html>